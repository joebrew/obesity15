---
title: "1st grade obesity and overweight in Alachua County"
author: "Ben Brew and Joe Brew"
date: "September 11, 2015"
output: html_document
---

```{r, echo = FALSE}
library(knitr)
library(scales)
opts_chunk$set(comment = NA, warning = FALSE, message = FALSE, echo = FALSE)
```

```{r}
# READ IN CLEANED UP OBESITY DATA
source('read_in.R')
set_directories()
```

  This report briefly summarizes and visualizes the distribution of "obese" 1st graders across schools, socioeconomic status, and race in Alachua County public schools. The obesity rate is defined as the proportion of students classified as obese or overweight. according to his or her body mass index (BMI).  The time period of interest is 2007-2014. 
  
# Obesity Trends of the Entire 1st Graade Population from 2007-2014


```{r}
# Make column names for screen lower case 
names(screen) <- tolower(names(screen))

# Subset to 1st grade 
screen_first <- screen[which(screen$grade == '1'),]

# Make year a factor 
screen_first$year <- as.factor(screen_first$year)

# use make.names to avoid "duplicate columns error"
valid_column_names <- make.names(names=names(screen_first), unique=TRUE, allow_ = TRUE)
names(screen_first) <- valid_column_names

# group by weight category and summarise 
obese <- screen_first %>%
  group_by(year) %>% 
  summarise(overweight = sum(catbi == "overweight"),
            total = n())

# Make a column in obese for percent obese for each year
obese$percent <- (obese$overweight/obese$total)*100
obese$percent <- round(obese$percent, 2)

# plot overweight percent over time using bargraph 
ggplot(data = obese, aes(year, percent)) + geom_bar(colour = "lightblue", fill = "black",stat = "identity", alpha = 0.5) + xlab("") + ylab("Obesity Rate (%)") + ggtitle("Obesity Rate for First Graders") + ylim(c(0, 40)) + theme_bw() + ggtitle('Figure 1') + 
geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white")
```

  Figure 1 shows the obesity rate for all 1st graders by year. First grade obesity  varies between 24% and 32% since 2007, with it peaking in 2007 and bottoming out in 2013. 
  Figure 2 shows the obesity rate by race over time (2007-2014). Asian 1st graders enjoy the lowest obesity rate followed by their White classmates. Black and Hispanic 1st graders have a consistently and substantially higher obesity rate converging to a rate nearly twice as high as their Asian classmates in 2014. 
 
```{r}
# Group by year and race and summarise for overweight 
race <- screen_first %>% 
  group_by(year, race) %>%
  summarise(overweight = sum(catbi == 'overweight'),
            total = n())

# Drop Indian from the graph because of small sample size
race <- race[which(race$race != 'Indian'),]

# Make percent for each variable 
race$percent_obese <- (race$overweight/race$total)*100
race$percent_obese <- round(race$percent_obese, 2)

# Plot each race obesity rate through time 
ggplot(data = race, aes(year, percent_obese, group = race, colour = race)) + geom_line(size = 2) + 
  ylim(c(0,65)) + xlab("") + ylab("Obesity Rate (%)")+ ggtitle('Figure 2') + 
  scale_colour_brewer(palette="Set2") + theme_bw() + labs(color = "Race")                                                                   

```

Figure 3, below, plots the obesity rate by lunch status. Lunch status is the closest proxy for income available in the data. Those qualifying for free lunch do so as a result of a lower family income. Besides 2008, students who receive free lunch have a significantly higher obesity rate. 

Figure 4 shows the same discrepancy does not exist between male and female students. Over time, the obesity rate for both sexes has remained largely similar. However, in 2014, the obesity rate for female 1st graders a is roughly 5% higher than male 1st graders

```{r}
# Group by year, lunch status and summarise for race 
lunch <- screen_first %>% 
  filter(!is.na(lunch)) %>%
  group_by(year, lunch) %>%
  summarise(overweight = sum(catbi == 'overweight'),
            total = n())

# Make percent for each variable 
lunch$percent_obese <- (lunch$overweight/lunch$total)*100
lunch$percent_obese <- round(lunch$percent_obese, 2)

# Plot each race obesity rate through time 
ggplot(data = lunch, aes(year, percent_obese, group = lunch, colour = factor(lunch, labels = c("Free", "Not Free")))) + geom_line(size = 2) + ylim(c(0,50)) + xlab("") + ylab("Obesity Rate (%)") + ggtitle("Figure 3") +  scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .6)) + theme_bw() + labs(color = "Lunch Status")                                                                                                                                                                                                                                                                      
  
```
 

```{r}
# Group by year, gender status and summarise for race 
gender <- screen_first %>%
  group_by(year, gender) %>%
  summarise(overweight = sum(catbi == 'overweight'),
            total = n())

# Make percent for each variable 
gender$percent_obese <- (gender$overweight/gender$total)*100
gender$percent_obese <- round(gender$percent_obese, 2)

# Plot each race obesity rate through time 
ggplot(data = gender, aes(year, percent_obese, group = gender, colour = factor(gender, labels = c("Female", "Male")))) + geom_line(size = 2) + ylim(c(0,50)) + xlab("") + ylab("Obesity Rate (%)") + ggtitle("Figure 4") + labs(color = "Gender") + 
  theme_bw() + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .6))

```


```{r}
library(reshape2)
# use make.names to avoid "duplicate columns error"
valid_column_names <- make.names(names=names(screen), unique=TRUE, allow_ = TRUE)
names(screen) <- valid_column_names

# recode personid to character
screen$personid <- as.character(screen$personid)

# Subset data where every observation for 1st grader has a corresponding 6th grade observation
dat <- screen[screen$grade == '1' | screen$grade == '6', ]

# Recode grade to character as it will be a column name later 
dat$grade <- ifelse(dat$grade == '1', 'first', 'sixth')

# Keep only the necessary columns
dat <- dat[, c("personid", "grade", "z")]

# Remove NAs 
dat <- dat[!is.na(dat$personid),]

# Create vector of true and false where true indicates if it is a duplicate
dups <- duplicated(dat$personid) 

# cbind dups onto dat
dat_new <- cbind(dat, dups)

# drop all rows where dups == false
dat_dupe <- dat_new[which(dat_new$dups == TRUE),]

# drop dups column
dat_dupe <- dat_dupe[, c("personid", "grade", "z")]

# Sort dat_dupe by personid 
dat_dupe <- dat_dupe[order(dat_dupe$personid),]

# Make so there are columns for first and 6th grade data
dat_final <- dcast(dat_dupe, personid ~ grade, 
                   fun.aggregate = last)

# plot 1st grade bmi percentile by 6th grade bmi percentile 
plot(dat_final$first, dat_final$sixth, 
     pch = 16,
     bty = 'n',
     cex = 1.2, 
     col = adjustcolor("blue", alpha.f = 0.6),
     xlab = "First Grade Weight Z Score",
     ylab = "Sixth Grade Weight Z Score",
     main = "Figure 5")
abline(0, 1)

```

Student weight data is collected in 1st, 3rd, and 6th grade. Firgure 5 shows the correlation between a students weight (BMI z score) in 1st and 6th grade. If a student's weight in 1st grade was exactly correlated with his or her 6th grade weight, the observations should fall close to the 45 degree line. The sample size was heavily restricted due to lack of data for students with both 1st and 6th grade weight scores, however the uniformity of the data points around the 45 degree line suggests that weight in 1st grade is predictive of weight in 6th grade.

# Obesity Rates by School

```{r}
# Make school a factor 
screen_first$school <- as.factor(screen_first$school)
# Subset screen_first to only have large schools
screen_large <- screen_first[which(screen_first$school == 'CHILES, LAWTON M. ELEMENTARY' |
                                     screen_first$school == 'FINLEY, J. J. ELEMENTARY ' |
                                     screen_first$school == 'GLEN SPRINGS ELEMENTARY' |
                                     screen_first$school == 'HIDDEN OAK ELEMENTARY' |
                                     screen_first$school == 'IDYLWILD ELEMENTARY' |
                                     screen_first$school == 'IRBY, W.W. ELEMENTARY' |
                                     screen_first$school == 'LITTLEWOOD ELEMENTARY' |
                                     screen_first$school == 'NEWBERRY ELEMENTARY ' |
                                     screen_first$school == 'TALBOT, WILLIAM S. ELEMENTARY' |
                                     screen_first$school == 'TERWILLIGER, MYRA ELEMENTARY' |
                                     screen_first$school == 'WILES, KIMBALL ELEMENTARY'),]
                                     
# Examine average obesity rate as each school
school_year <- screen_large %>%
  group_by(school) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percentage 
school_year$percent <- (school_year$obese/school_year$total)*100
school_year$percent <- round(school_year$percent, 2)

# Plot average obesity rate for each school over the last 7 years
ggplot(data = school_year, aes(reorder(school,-percent), percent)) + geom_bar(stat = "identity", colour = 'lightblue', fill = 'black', alpha = 0.5) + theme_bw() + xlab('') + ylab('Percent Overweight') +theme(axis.text.x = element_text(colour="grey20",size=5,angle=0,hjust=0.7,vjust=.7,face="plain")) + ggtitle('Figure 6')+ geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + scale_x_discrete(labels=c("Terwilliger", "Hidden Oak", "Idylwild", "W.W. Irby", "Kimball Wiles", "Lawton Chiles", "Glenn Springs", "Littlewood", "Talbot"                                                                                                                                                                                                              ))

```

Figure 6 gives the average obesity rate for schools in Alachua county that have a 1st grade population over 600 students from 2007-2014. Smaller schools are kept out of the remaining analysis due to the high variability of their obesity rates. Tewiliger has the highest average obesity rate for 1st graders among the larger schools at 36.15%. 

Figure 7 shows how the obesity rater for the same large schools changes over time. Although Hidden Oak had the highest 1st grade obesity rate in 2007, it rapidly decreased over time. Terwiliger, on the other hand, exerienced a consistently high 1st grade obesity rate with a spikes in 2007 and 2014. Both Talbot and Littlewood Elementary school have consistently low obesity rates throughout the observed time period.  

```{r}
# Make school a factor 
screen_first$school <- as.factor(screen_first$school)
# Subset screen_first to only have large schools
screen_large <- screen_first[which(screen_first$school == 'CHILES, LAWTON M. ELEMENTARY' |
                                     screen_first$school == 'FINLEY, J. J. ELEMENTARY ' |
                                     screen_first$school == 'GLEN SPRINGS ELEMENTARY' |
                                     screen_first$school == 'HIDDEN OAK ELEMENTARY' |
                                     screen_first$school == 'IDYLWILD ELEMENTARY' |
                                     screen_first$school == 'IRBY, W.W. ELEMENTARY' |
                                     screen_first$school == 'LITTLEWOOD ELEMENTARY' |
                                     screen_first$school == 'NEWBERRY ELEMENTARY ' |
                                     screen_first$school == 'TALBOT, WILLIAM S. ELEMENTARY' |
                                     screen_first$school == 'TERWILLIGER, MYRA ELEMENTARY' |
                                     screen_first$school == 'WILES, KIMBALL ELEMENTARY'),]
                                     
# Examine average obesity rate as each school
school_year <- screen_large %>%
  group_by(year,school) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percentage 
school_year$percent <- (school_year$obese/school_year$total)*100
school_year$percent <- round(school_year$percent, 2)

# Plot average obesity rate for each school over the last 7 years
ggplot(data = school_year, aes(year, percent, group = school, colour = factor(school, labels = c("Lawton Chiles", "Glenn Springs","Hidden Oak","Idylwild", "W.W. Irby", "Littlewood", "Talbot", "Terwilliger", "Kimball Wiles")))) + geom_line(size = 1) + theme_bw() + xlab('') + ylab('Percent Overweight')  + ggtitle('Figure 7') + theme(legend.text = element_text(size = 5)) + labs(color = "School") + scale_colour_brewer(palette = "Set1")    
```



## Obesity Rates Within Schools

In this section we take a more in depth look at obesity rates among 1st graders in larger schools. That is, schools with a 1st grade population over 600. 

#### Lawton Chiles Elementary School 

Lawton Chiles Elementary School had a total of 832 1st grade students between 2007 and 2014 and an average obesity rate of 22.36% for all first graders.
Figure 8 shows the proportions of those students who are classified as overweight according to their BMI. 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'CHILES, LAWTON M. ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 8') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Drop Indian 
dat_race <- dat_race[which(dat_race$race != 'Indian'),]

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 9') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

In line with the general trend, Asian 1st graders at Lawton Chiles have a significantly lower obesity rate relative to their 1st grade class mates. 

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 10') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

Figure 10 shows that in recent years, female 1st graders at Lawton Chiles have a higher obesity rate than their male classmates. The other years show a much higher obesity rate for males than females. The general trend for both males and females is neigher substantially rising or falling over time. 

figure 11 show the relationship between obesity and free lunch status. Those qualifying for free lunch have, on average, a higher obesity rate, but it varies depeding on the year. Obesity rates for both populations looked to be decreasing in recent years, but 2014 shows a slight increase in students not qualifying for free lunch and a large increase for those 1st graders qualifying for free lunch. 

###  Obesity rate by lunch (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) + geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('grey', 'black'), .6)) + ggtitle('Figure 11') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
position = position_dodge(width=0.5)
```

## Glenn Springs Elementary 
Glenn Springs Elementary had a total of 604 1st graders between 2007 and 2014 and an average obesity rate of 22.19%. Figure 12 shows a peak in obesity rates in 2011 and 2012. Unlike Lawton Chiles, multiracial students make up the highest proportion of overweight 1st graders, followed by asians (Figure 13). This due mainly to a smaller sample size for the Asian population. 

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'GLEN SPRINGS ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 12') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 13') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 14') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```


###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 15') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## Hidden Oak Elementary 
Hidden Oak Elementary 994 total 1st graders between 2007-2014 and the second highest obesity rate at 29.28%. This is mainly a result of the abnormally high obesity rate in 2000 (60.87). Since 2007, however, they obesity rate dropped off and went as low at 17% in 2013. 

In 2007 the high obesity rate was driven by the male 1st graders and those who did not qualify for free lunch. Both of these populations have seen a steadily falling obesity rate since 2007, whereas students qualifying for free lunch have followed a much more unstable trend (figure 18 & 19)

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'HIDDEN OAK ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 16') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 17') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 18') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 19') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## Idylwild Elementary  

Idylwild Elementary had 781 total 1st graders between 2007-2014 and 28.55 average obesity rate, 3rd among all large Alachua County public schools. Unlike Hidden Oak, Idylwild's higher ranking is a result of a high obesity rate in 2014 (43.44%).

The hispanic 1st grade population has the highest obesity rate at Idylwild at 46.27%. The relationship between obesity and gender shows no striking temporal patterns. This is also true for free lunch status. 


### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'IDYLWILD ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 20') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Drop Indian 
dat_race <- dat_race[which(dat_race$race != 'Indian'),]

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 21') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 22') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 23') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## W.W. Irby Elementary  

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'IRBY, W.W. ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 24') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 25') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 26') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 27') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## Littlewood Elementary  

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'LITTLEWOOD ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 28') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 29') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 30') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 11') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## William S. Talbot Elementary  

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'TALBOT, WILLIAM S. ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 8') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 9') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 10') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 11') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## Terwilliger Elementary 

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'TERWILLIGER, MYRA ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 8') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 9') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 10') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 11') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

## Kimball Wiles Elementary

### Obesity Rate by Year 

```{r}
# Make a data frame by school 
school <- screen_first[which(screen_first$school == 'WILES, KIMBALL ELEMENTARY'),]

# group by year and summarise for obese rate 
dat_school <- school %>%
  group_by(year) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# make percent 
dat_school$percent <- (dat_school$obese/dat_school$total)*100
dat_school$percent <- round(dat_school$percent, 2)

# bar plot obesity rate 
ggplot(data = dat_school, aes(year, percent)) + geom_bar(stat = 'identity', fill = 'black', colour = 'lightblue', alpha = 0.5) + geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + xlab('') + ylab('Obesity Rate (%)') + ggtitle('Figure 8') + theme_bw()

```



```{r, fig.show='hide'}
# Group by year and race 
dat_race <- school %>%
  group_by(year,race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(year, percent, group = dat_race$race, colour= dat_race$race)) + 
  geom_line() + theme_bw()
```

###  Obesity rate by race aggregated 2007-2014

```{r}
# Group by year and race 
dat_race <- school %>%
  group_by(race) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_race$percent <- (dat_race$obese/dat_race$total)*100
dat_race$percent <- round(dat_race$percent, 2)

# Line graph
ggplot(data = dat_race, aes(race, percent)) + 
  geom_bar(stat = 'identity', fill = "black", colour = "lightblue", alpha = 0.5) + 
  geom_text(aes(label=percent), position=position_dodge(width=0.9), vjust=1.5, colour = "white") + ggtitle('Figure 9') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```

###  Obesity rate by gender (2007-2014)

```{r}
library(scales)
# Group by year and  gender 
dat_gender <- school %>%
  group_by(year, gender) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_gender$percent <- (dat_gender$obese/dat_gender$total)*100
dat_gender$percent <- round(dat_gender$percent, 2)

# Bar graph
ggplot(data = dat_gender, aes(year, percent)) +
  geom_bar(aes(fill = factor(gender, labels = c('Female', 'Male'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Gender",values = alpha(c('#0023a0', '#f9a635'), .7)) + 
  ggtitle('Figure 10') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()
```

###  Obesity rate by lunch status (2007-2014)

```{r}
# Group by year and lunch status 
dat_lunch <- school %>%
  group_by(year, lunch) %>%
  summarise(obese = sum(catbi == 'overweight'),
            total = n())

# Make percent 
dat_lunch$percent <- (dat_lunch$obese/dat_lunch$total)*100
dat_lunch$percent <- round(dat_lunch$percent, 2)

# Bar graph
ggplot(data = dat_lunch, aes(year, percent)) +
  geom_bar(aes(fill = factor(lunch, labels = c('Free', 'Not Free'), )), stat = 'identity', position = 'dodge') + scale_fill_manual("Lunch Status",values = alpha(c('black', 'grey'), .6)) + 
  ggtitle('Figure 11') + xlab('') + ylab('Obesity Rate (%)') + theme_bw()

```